CREATE TABLE IF NOT EXISTS "contracts" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "AGENT_ID" BIGINT NOT NULL,
    "CUSTOMER_NAME" NVARCHAR(255) NOT NULL,
    "DESCRIPTION" NVARCHAR(1000),
    "START_DATE" DATE NOT NULL,
    "END_DATE" DATE,
    "TOTAL_VALUE" DECIMAL(19, 2) NOT NULL,
    "STATUS" NVARCHAR(50) NOT NULL,
    CONSTRAINT fk_contracts_agents
        FOREIGN KEY ("AGENT_ID") REFERENCES "agents"("ID")
);

CREATE TABLE IF NOT EXISTS "invoices" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "CONTRACT_ID" BIGINT,
    "INVOICE_NUMBER" NVARCHAR(100) NOT NULL,
    "CUSTOMER_NAME" NVARCHAR(255) NOT NULL,
    "AMOUNT" DECIMAL(19, 2) NOT NULL,
    "ISSUE_DATE" DATE NOT NULL,
    "DUE_DATE" DATE,
    "STATUS" NVARCHAR(50) NOT NULL,
    "PAYMENT_DATE" DATE,
    "NOTES" NVARCHAR(1000),
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "UPDATED_AT" DATETIME2,
    CONSTRAINT fk_invoices_contract
        FOREIGN KEY ("CONTRACT_ID") REFERENCES "contracts"("ID")
);

CREATE UNIQUE INDEX IF NOT EXISTS uq_invoices_number
ON "invoices" ("INVOICE_NUMBER");

CREATE TABLE IF NOT EXISTS "document_history" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "DOCUMENT_TYPE" NVARCHAR(50) NOT NULL,
    "DOCUMENT_ID" BIGINT NOT NULL,
    "ACTION" NVARCHAR(50) NOT NULL,
    "DESCRIPTION" NVARCHAR(1000),
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "commissions" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "AGENT_ID" BIGINT NOT NULL,
    "CONTRACT_ID" BIGINT NOT NULL,
    "TOTAL_COMMISSION" DECIMAL(19, 2) NOT NULL,
    "PAID_COMMISSION" DECIMAL(19, 2) NOT NULL,
    "PENDING_COMMISSION" DECIMAL(19, 2) NOT NULL,
    "LAST_UPDATED" DATETIME2 NOT NULL,
    CONSTRAINT fk_commission_contract
        FOREIGN KEY ("CONTRACT_ID") REFERENCES "contracts"("ID"),
    CONSTRAINT fk_commission_agent
        FOREIGN KEY ("AGENT_ID") REFERENCES "agents"("ID"),
    CONSTRAINT uq_commission_agent_contract
        UNIQUE ("AGENT_ID", "CONTRACT_ID")
);
