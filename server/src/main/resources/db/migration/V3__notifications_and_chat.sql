CREATE TABLE IF NOT EXISTS "notifications" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "USER_ID" BIGINT NOT NULL,
    "MESSAGE" NVARCHAR(1000) NOT NULL,
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "READ_AT" DATETIME2,
    CONSTRAINT fk_notifications_users
        FOREIGN KEY ("USER_ID") REFERENCES "users"("ID")
);

CREATE TABLE IF NOT EXISTS "chat_rooms" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "NAME" NVARCHAR(255) NOT NULL,
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "chat_messages" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ROOM_ID" BIGINT NOT NULL,
    "SENDER_ID" BIGINT NOT NULL,
    "CONTENT" NVARCHAR(2000) NOT NULL,
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_chat_messages_room
        FOREIGN KEY ("ROOM_ID") REFERENCES "chat_rooms"("ID"),
    CONSTRAINT fk_chat_messages_sender
        FOREIGN KEY ("SENDER_ID") REFERENCES "users"("ID")
);

CREATE TABLE IF NOT EXISTS "chat_participants" (
    "ROOM_ID" BIGINT NOT NULL,
    "USER_ID" BIGINT NOT NULL,
    "JOINED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_chat_participants_room
        FOREIGN KEY ("ROOM_ID") REFERENCES "chat_rooms"("ID"),
    CONSTRAINT fk_chat_participants_user
        FOREIGN KEY ("USER_ID") REFERENCES "users"("ID"),
    CONSTRAINT pk_chat_participants PRIMARY KEY ("ROOM_ID", "USER_ID")
);
