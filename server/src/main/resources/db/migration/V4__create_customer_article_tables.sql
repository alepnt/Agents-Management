CREATE TABLE IF NOT EXISTS "customers" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "NAME" NVARCHAR(255) NOT NULL,
    "VAT_NUMBER" NVARCHAR(50),
    "TAX_CODE" NVARCHAR(50),
    "EMAIL" NVARCHAR(255),
    "PHONE" NVARCHAR(50),
    "ADDRESS" NVARCHAR(500),
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "UPDATED_AT" DATETIME2
);

CREATE TABLE IF NOT EXISTS "articles" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "NAME" NVARCHAR(255) NOT NULL,
    "SKU" NVARCHAR(100) NOT NULL UNIQUE,
    "UNIT_PRICE" DECIMAL(19, 2) NOT NULL,
    "DESCRIPTION" NVARCHAR(1000),
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "UPDATED_AT" DATETIME2
);

CREATE TABLE IF NOT EXISTS "orders" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "CUSTOMER_ID" BIGINT NOT NULL,
    "ORDER_DATE" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "STATUS" NVARCHAR(50) NOT NULL,
    "TOTAL_AMOUNT" DECIMAL(19, 2) NOT NULL,
    CONSTRAINT fk_orders_customer FOREIGN KEY ("CUSTOMER_ID") REFERENCES "customers"("ID")
);

CREATE TABLE IF NOT EXISTS "order_items" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ORDER_ID" BIGINT NOT NULL,
    "ARTICLE_ID" BIGINT NOT NULL,
    "QUANTITY" INT NOT NULL,
    "UNIT_PRICE" DECIMAL(19, 2) NOT NULL,
    CONSTRAINT fk_order_items_order FOREIGN KEY ("ORDER_ID") REFERENCES "orders"("ID"),
    CONSTRAINT fk_order_items_article FOREIGN KEY ("ARTICLE_ID") REFERENCES "articles"("ID")
);

CREATE TABLE IF NOT EXISTS "customer_notes" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "CUSTOMER_ID" BIGINT NOT NULL,
    "NOTE" NVARCHAR(1000) NOT NULL,
    "CREATED_AT" DATETIME2 NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_customer_notes_customer FOREIGN KEY ("CUSTOMER_ID") REFERENCES "customers"("ID")
);

CREATE TABLE IF NOT EXISTS "article_stock" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ARTICLE_ID" BIGINT NOT NULL,
    "WAREHOUSE" NVARCHAR(255) NOT NULL,
    "QUANTITY" INT NOT NULL,
    "UPDATED_AT" DATETIME2 NOT NULL,
    CONSTRAINT fk_article_stock_article FOREIGN KEY ("ARTICLE_ID") REFERENCES "articles"("ID")
);

CREATE UNIQUE INDEX IF NOT EXISTS uq_articles_sku ON "articles" ("SKU");
